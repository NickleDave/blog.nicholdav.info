<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="David Nicholson">
<meta name="dcterms.date" content="2022-12-26">
<meta name="description" content="How to structure your Python package so other researchers want to use it">

<title>Four tips for structuring your research groupâ€™s Python packages</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-2c128a76c5dbb243be50ea3089ffe19d.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://nicholdav.info/"> 
<span class="menu-text">home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://nicholdav.info/about.html"> 
<span class="menu-text">about</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://blog.nicholdav.info/"> 
<span class="menu-text">blog</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/NickleDave"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://bsky.app/profile/nicholdav.bsky.social"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Four tips for structuring your research groupâ€™s Python packages</h1>
                  <div>
        <div class="description">
          How to structure your Python package so other researchers want to use it
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">research software engineering</div>
                <div class="quarto-category">Python</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>David Nicholson </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">December 26, 2022</p>
      </div>
    </div>
    
      <div>
      <div class="quarto-title-meta-heading">Modified</div>
      <div class="quarto-title-meta-contents">
        <p class="date-modified">January 8, 2025</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>Update 2025-09-22: Made some small tweaks to language, but didnâ€™t hate what I wrote as much as I thought.</p>
<p>Update 2025-01-08:<br>
I think this post gives better advice overall on designing a Python library API:<br>
<a href="https://benhoyt.com/writings/python-api-design/" class="uri">https://benhoyt.com/writings/python-api-design/</a><br>
You should read that one first, then come back and read this one for some examples of what <em>not</em> to do.</p>
<hr>
<p>This is one of those petulant posts from someone who writes software. A post from one of those people that describes some library they wrote as â€œopinionatedâ€, as if the rest of us have been living in fear of expressing our opinions through software.</p>
<p>So, sorry in advance. But I want to talk about some things I see a lot in Python packages shared by research groups.</p>
<p>At the highest level, thereâ€™s two things I see: one, researchers name their modules in a way that might make sense when youâ€™re writing your own code, but can seem very verbose or non-intuitive when you are someone else on the outside reading or using that code. Two, I see a lot of code that doesnâ€™t structure itself in a way that makes it easier for people to read it and to use it. And youâ€™re sharing your code because you want people to use it, right?</p>
<p>I think a lot of packages from research labs end up this way in part because researchers donâ€™t have a good <a href="https://teachtogether.tech/en/#s:models">mental model</a> of the mapping from their written code to the package they import. In other words, they donâ€™t have a clear picture of how Python translates the directory structure of their code and its internal <code>import</code> statements into a package name with modules that can be accessed with the dot operator, like so: <code>package.subpackage.module.function</code>.</p>
<p>To use more technical terms, the code does not fully leverage the fact that Python treats modules as <a href="https://realpython.com/python-namespaces-scope/">namespaces</a>. Namespaces are a way of collecting the objects like functions and classes that we define in code into (named) groups. (Some other people that teach Python to scientists also seem to think itâ€™s worth knowing how namespaces relate to imports and modules, since they wrote <a href="https://openastronomy.org/rcsc18/chapters/04-further-python/03-imports-and-namespaces">this page</a>.) If I may invoke the holy sayings of the revered masters, <a href="https://inventwithpython.com/blog/2018/08/17/the-zen-of-python-explained/">â€œnamespaces are a honking great ideaâ€</a>. To a wizened software engineer, that phrase from the Zen of Python might sound like Python is patting itself on the back for something that basically every modern language does. But for many researchers that are getting their first experience designing a software library, it might seem surprising that Iâ€™m drawing a connection between the pile of files that constitues their code and an abstraction from computer science. If it sounds surprising to you, maybe itâ€™s because you donâ€™t (yet) have a good <a href="https://teachtogether.tech/en/#s:memory-concept-maps">concept map</a> of how namespaces relate to naming your modules and structuring your package.</p>
<p>So let me tell you a little bit about that, and how you can build on it to make your code much more accessible. I donâ€™t claim to have a perfect mental model of Python packages, but at least I have fought enough with my own code, and read enough of others peoplesâ€™ code, that I think I can say something useful here. This post contains some things Iâ€™ve learned the hard way, to hopefully save you from repeating the mistakes of past me.</p>
<p>Iâ€™ve boiled it down to four tips, that Iâ€™ll explain in more detail below.</p>
<p>Hereâ€™s the high-level version:</p>
<ol type="1">
<li>Give your packages and modules terse, single-word names whenever possible.</li>
<li>Import modules internally, instead of importing everything <em>from</em> modules.</li>
<li>Make use of sub-packages.</li>
<li>Prefer modules with very specific names containing single functions over modules with very general names like <code>utils</code>, <code>helpers</code>, or <code>support</code> that contain many functions.</li>
</ol>
<p>Of course, it goes without saying that these are absolute rules that came to me in a dream where Guido Van Rossum emerged from a burning bush and handed them to me on a freshly-minted <a href="https://peps.python.org/pep-0000/">PEP</a>. As such, you should never violate them for any reason, unless you feel like it. (Those last two sentences should be written in the sarcasm font.) More seriously, you could call these rules, but there are sometimes good reasons to not follow them to the letter, like weâ€™ll see below.</p>
<p>One other thing to say before we get started: I will use some examples here inspired by real life, but namespaces have been changed to protect the innocent. I promise my goal here is not to name shame, but instead to help you make your code as accessible as possible. I also want to note this is <em>not</em> meant to be a whole tutorial, just some pointers on how to pick module names and how to structure your package in a way that makes your code more immediately accessible and more readable. For an introductory tutorial to packages and modules, please see <a href="https://realpython.com/python-modules-packages/" class="uri">https://realpython.com/python-modules-packages/</a>.</p>
<section id="an-example-of-what-not-to-do" class="level2">
<h2 class="anchored" data-anchor-id="an-example-of-what-not-to-do">An example of what <em>not</em> to do</h2>
<p>Hereâ€™s the scenario: You are really into sharing your research code written in Python. Great! Sharing code just makes sense to you. Your lab is getting on board with this too. You made a <a href="https://docs.github.com/en/organizations/collaborating-with-groups-in-organizations/about-organizations">GitHub organization</a> for the research group (instead of making an individual profile with the lab name! Please donâ€™t do that, and make an org page instead, so we can see whoâ€™s in your group and understand who contributes what! For when I want to write you an email thanking you for your work, or ask you to collaborate, or figure out who I want to hire away from academia into the private sector ğŸ˜ˆ).</p>
<p>Now everybody in the lab is forking their repos to that org, so you can collaborate and all rely on the same version of the same code. I go to your labâ€™s org page and check out one of the repos, and I see something like this.</p>
<pre><code>electroymyographytoolkit
â”œâ”€â”€ emg_load_inchan_data_four_channelinkls.py
â”œâ”€â”€ emg_main.py
â”œâ”€â”€ emg_simulate.py
â”œâ”€â”€ emg_solver.py
â”œâ”€â”€ emg_utils.py
â””â”€â”€ __init__.py
</code></pre>
<p>In the words of a wise man:</p>
<blockquote class="blockquote">
<p>Oh No Baby! What Is You Doin???</p>
</blockquote>
<p><cite> â€” <a href="https://knowyourmeme.com/memes/oh-no-baby-what-is-you-doin"><code>nicknpattiwhack_</code></a></cite></p>
</section>
<section id="what-you-should-do-instead" class="level2">
<h2 class="anchored" data-anchor-id="what-you-should-do-instead">What you should do instead</h2>
<p>Please! Help as many people as possible actually use your code by avoiding naming and package structures like that! Instead you want something like this:</p>
<pre><code>emgtoolkit
â”œâ”€â”€ load.py
â”œâ”€â”€ main.py
â”œâ”€â”€ simulate.py
â”œâ”€â”€ solvers
â”‚&nbsp;&nbsp; â”œâ”€â”€ brute_force.py
â”‚&nbsp;&nbsp; â”œâ”€â”€ entropy.py
â”‚&nbsp;&nbsp; â”œâ”€â”€ gibson.py
â”‚&nbsp;&nbsp; â”œâ”€â”€ __init__.py
â”‚&nbsp;&nbsp; â”œâ”€â”€ random_walk.py
â”‚&nbsp;&nbsp; â””â”€â”€ shannon.py
â”œâ”€â”€ timestamp.py
â””â”€â”€ __init__.py</code></pre>
<p>The changes I made above follow the aforementioned four tips. Hereâ€™s they are again, the short version of what you want to do:</p>
<ol type="1">
<li>Give your packages and modules terse, single-word names whenever possible.</li>
<li>Import modules internally, instead of importing everything <em>from</em> modules. (You canâ€™t see this directly in the example above, but Iâ€™ll show it below.)</li>
<li>Make use of sub-packages.</li>
<li>Prefer modules with very specific names containing single functions over modules with very general names like <code>utils</code>, <code>helpers</code>, or <code>support</code> that contain many functions.</li>
</ol>
<p>All of these rules help you make code written with your package more readable from the <em>outside</em>, when someone else uses it from a script. Rules 2,3, and 4 in particular can also help make your code more readable from the <em>inside</em>, when you revisit it after you spent six months in the lab fighting with weird noise from your electrophysiology rig or an IHC protocol or whatever it is that scientists do, I donâ€™t remember anymore ([laughs in post-academic]).</p>
</section>
<section id="please-dont-name-your-modules-package.pkg_module" class="level2">
<h2 class="anchored" data-anchor-id="please-dont-name-your-modules-package.pkg_module">Please donâ€™t name your modules <code>package.pkg_module</code></h2>
<p>Okay, I will briefly, just for one paragraph, get really â€œopinionatedâ€. I am not yelling at you. Iâ€™m yelling <em>with</em> you, from the perspective of you as a future user and reader of your own code. (Borrowing a concept from physics while simultaneously breaking its laws, we change our frame of reference and do some time travel so that what you named your modules is <em>no longer</em> a problem for â€œfuture youâ€ to solve.)</p>
<p>Hereâ€™s our example package layout again:</p>
<pre><code>electroymyographytoolkit
â”œâ”€â”€ emg_load_inchan_data_four_channelinkls.py
â”œâ”€â”€ emg_main.py
â”œâ”€â”€ emg_simulate.py
â”œâ”€â”€ emg_solver.py
â”œâ”€â”€ emg_utils.py
â””â”€â”€ __init__.py
</code></pre>
<p><strong>yelling</strong>:<br>
Look at this. What is this?! No one wants to type out <code>package.pkg_solver</code>! Why are you making me redundantly type the package name again <em>after I just typed it</em>? Only instead youâ€™re making me <em>remember</em> and type some abbreviated version of the package name that you dropped some vowels from arbitrarily? <em>And</em>, <strong>and</strong> youâ€™re making me type an underscore, that my hand has to go find the shift key for! Every time!!! Yes I know that tab complete exists! This is still too much typing!!! Why do you hate me?</p>
<p>More calmly:<br>
That might seem like a weirdly specific example to you, but I have seen naming schemes like this more than once (hence, this post). I really do think it has something to do with the way other researchers are thinking about code while writing it and when importing it. They want to import a module <em>from</em> their package and know where it came from, so they put the package name in the module name. I guess? <span class="emoji" data-emoji="shrug">ğŸ¤·</span> Instead of doing anything like that, just name your package and modules something terse from the get-go, like</p>
<pre><code>emgtoolkit
â”œâ”€â”€ load.py
â”œâ”€â”€ main.py
â”œâ”€â”€ simulate.py
â”œâ”€â”€ solvers
â”‚&nbsp;&nbsp; â”œâ”€â”€ brute_force.py
â”‚&nbsp;&nbsp; â”œâ”€â”€ entropy.py
â”‚&nbsp;&nbsp; â”œâ”€â”€ gibson.py
â”‚&nbsp;&nbsp; â”œâ”€â”€ __init__.py
â”‚&nbsp;&nbsp; â”œâ”€â”€ random_walk.py
â”‚&nbsp;&nbsp; â””â”€â”€ shannon.py
â”œâ”€â”€ timestamp.py
â””â”€â”€ __init__.py</code></pre>
<p>Now in your scripts you can write out the whole package name, while at the same time having it be more succinct and clear what part of the packageâ€™s namespace youâ€™re referring to. E.g., <code>emgtoolkit.simulate</code> instead of <code>electromyographytoolkit.emg_simulate</code>. You might have noticed some other things changed in the names, too. Those changes relate to the other tips, that Iâ€™ll say more about below.</p>
</section>
<section id="please-dont-name-your-modules-package.incredibly_long_technical_name" class="level2">
<h2 class="anchored" data-anchor-id="please-dont-name-your-modules-package.incredibly_long_technical_name">Please donâ€™t name your modules <code>package.incredibly_long_technical_name</code></h2>
<p>There is also an even more extreme form of verbose module names, that takes the form of:</p>
<pre><code>pkg/
  incredibly_long_technical_name_or_specific_task</code></pre>
<p><em>Sometimes</em> this is justified, if itâ€™s the core functionality of your package and you really need to clearly communicate to everyone in the universe what the package does. E.g., <code>sklearn.model_selection</code> has a very specific meaning, and itâ€™s hard to capture with an abbreviation, and the library is trying to capture basically several sub-fields of machine learning within this sub-package. I am okay with tab-completing this name just so itâ€™s clear to all of us what the heck weâ€™re doing. But <code>pkg.preprocessing_electrophysiological_data</code> is not a great name. Especially if your package <em>only</em> deals with electrophysiological data. You can just say <code>pkg.preprocess</code>, itâ€™s fine.</p>
<section id="instead-make-module-names-general-and-move-specifics-to-function-names" class="level3">
<h3 class="anchored" data-anchor-id="instead-make-module-names-general-and-move-specifics-to-function-names">Instead, make module names general, and move specifics to function names</h3>
<p>Often these really long module names can be a very specific thing you need to do. Here again you can make things more terse by moving the more specific part to a function name, while keeping the more general part as a module name. For example, instead of</p>
<pre><code>electroymyographytoolkit
â”œâ”€â”€ emg_load_inchan_data_four_channels.py</code></pre>
<p>name the module <code>load</code>, and name a function in that module <code>inchan_data_four_channels</code>, so that you can type out:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> emgtoolkit.load.inchan_data_four_channels()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Your intention is still obvious. But you rely on attribute access to make that intention clear, while simultaneously more succinct. This also means you have left yourself room later to add other <code>load</code> functions in your module, like</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> emgtoolkit.load.inchan_data_accelerometer_channel()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>or whatever. Trust me, there <em>will</em> be a later. Leave <em>space</em> in your namespace.</p>
</section>
</section>
<section id="import-modules-not-functions-and-classes-for-readability" class="level2">
<h2 class="anchored" data-anchor-id="import-modules-not-functions-and-classes-for-readability">Import modules, not functions and classes, for readability</h2>
<p>This is less about naming and more about importing, but itâ€™s related because I feel like this same anti-pattern arises from someone not understanding what it is that package structure gives you. It gives you a logical grouping thatâ€™s readable not just from the outside <em>but also from the inside</em>. Let me explain.</p>
<p>I often see something like this in an internal module:</p>
<pre><code># inside main.py
from pkg_solver import (
    EntropySolver,
    ShannonSolver,
    GibsonSolver,
    ...
    # 10 more lines of class imports from a single module (!)
    BruteForceSolver,
    RandomWalkSolver
)</code></pre>
<p>Letâ€™s say this is in <code>emgtoolkit/main.py</code>. Going back to the overall goal of this post, letâ€™s think about how the import above will affect the namespace of your package, as seen from the outside. if I am using your package, one of the first things Iâ€™m going to do is inspect the content of <code>emgtoolkit.main</code>, e.g.&nbsp;by running <code>dir(emgtoolkit.main)</code> in a Python REPL, since that name signals to me very loudly that you think of this as its main interface or API. With an import statement like the one above, when I tab complete while working with this module, I am going to be faced with a wall of <code>Solver</code> classes that obscures the true function of the module. This is not the <code>solver</code> module! Thatâ€™s some other module! If this is a high-level module that you expect me to access as a user, then please avoid polluting it with all these names. One of the ways you can do this is by making use of sub-packages, as Iâ€™ll talk about below.</p>
<p>I want to make a second point here, that is less about making external use of your code readable, and more about making it readable <em>internally</em>, within the code base. I know that right now while you are hacking on the code, you feel like you have all the low-level context about what all the moving parts are doing. But if you want to make life easier for yourself six months from now, and easier for everyone else that has to use your code, write in a way that <em>surfaces</em> that context. Write in a way that makes it much more obvious where all the functions and classes come from, leveraging the logical grouping that you spent so much time boiling down into concise module names.</p>
<p>Please, for your future self and everyone else, make the code readable by importing <em>just</em> the module <a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>, and then referring to those classes (or function or whatever youâ€™re referring to) via attribute access, i.e.&nbsp;with a dot, like <code>solver.BruteForceSolver</code>. You can get rid of many lines of imports at the top of your module <em>and</em> help yourself out when you are reading many lines deep in your own module, far from those imports, if you instead do this:</p>
<pre><code># just import one thing, don't pollute namespace
from . import solvers

...
# ~150 lines in
    if solve_strategy == "entropy"
        # ah, this is one of many solvers in this
        solver = solvers.EntropySolver()
    elif solve_strategy == "shannon"
        solver = solvers.ShannonSolver()</code></pre>
<p>One slight drawback of this terse approach is you can end up shadowing the most intuitive variable name for a class instance with a module that has a similar name. I.e., if I rename my module <code>pkg_solver</code> -&gt; <code>solver</code> then I wonâ€™t be able to do <code>from . import solver</code> at the top and then later <em>also</em> say <code>solver = solver.EntropySolver()</code>, because the variable name <code>solver</code> representing my class instance will clobber the name in the namespace that represents my <code>solver</code> module. This will cause Pythonâ€™s head to explode (and yours). In this case I prefer to either use an absolute import internally, <code>import pkg.solver</code>, or to alias internally, e.g., <code>from . import solver as solver_classes</code>, so that an <em>external</em> user <em>still</em> can write something simple like <code>pkg.solver</code>.</p>
<p>{:footnotes} *</p>
</section>
<section id="you-should-know-sub-packages-exist" class="level2">
<h2 class="anchored" data-anchor-id="you-should-know-sub-packages-exist">You should know sub-packages exist</h2>
<p>Again, this is less about naming, and more about structuring internals. But it falls under the same category of â€œthing I see that tells me you might not yet have a mental model of how to organize your code to make it easier for you to maintain in the long runâ€.</p>
<p>You should know (if you donâ€™t already) that you can make a sub-package inside your package. You do this the same way you make the package itself, by adding the magical <code>__init__.py</code> file that tells Python â€œthis directory is a packageâ€.</p>
<p>Here we add a <code>solvers</code> sub-package to the <code>emgtoolkit</code> package from our example.</p>
<pre><code>emgtoolkit
â”œâ”€â”€ solvers
â”‚&nbsp;&nbsp; â”œâ”€â”€ __init__.py
â””â”€â”€ __init__.py</code></pre>
<p>Here is an example in the Python docs on modules: <a href="https://docs.python.org/3/tutorial/modules.html#packages" class="uri">https://docs.python.org/3/tutorial/modules.html#packages</a></p>
<p>Going back to our example from above, we can refactor our (presumably gigantic) <code>solver</code> module into a handful of modules inside the <code>solver</code> sub-package:</p>
<pre><code>emgtoolkit
â”œâ”€â”€ load.py
â”œâ”€â”€ main.py
â”œâ”€â”€ simulate.py
â”œâ”€â”€ solvers
â”‚&nbsp;&nbsp; â”œâ”€â”€ brute_force.py
â”‚&nbsp;&nbsp; â”œâ”€â”€ entropy.py
â”‚&nbsp;&nbsp; â”œâ”€â”€ gibson.py
â”‚&nbsp;&nbsp; â”œâ”€â”€ __init__.py
â”‚&nbsp;&nbsp; â”œâ”€â”€ random_walk.py
â”‚&nbsp;&nbsp; â””â”€â”€ shannon.py
â”œâ”€â”€ timestamp.py
â””â”€â”€ __init__.py</code></pre>
<p>Then you can use imports so that, from the perspective of the user, they have access to the <em>same</em> modules with classes, functions, etc., that they had before. You do this by importing all the classes from each module in the sub-package inside the <code>__init__.py</code> of that sub-package.</p>
<pre><code>"""solver sub-package"""
# this is __init__.py
from .entropy_solver import EntropySolver
from .shannon_solver ShannonSolver
from .gibson_solver GibsonSolver
...</code></pre>
<p>This kind of looks like the thing I told you to <em>not</em> do above. But the difference here is that you are importing inside the <code>__init__.py</code> file, where (ideally) you are not hiding any functions; instead you are just doing some boring boilerplate imports here to make your life easier somewhere else. This lets you be more intentional about your API too. You can have some helper functions inside the sub-package modules that users donâ€™t really need. To broadcast to the world the stuff you think people need, you import just that stuff inside your sub-package <code>__init__.py</code></p>
<div class="notice">
<p>Python doesnâ€™t have a concept of â€œpublic and private members of objectsâ€, as languages like Java do, so thereâ€™s no (good) way for you to <strong>absolutely</strong> prevent someone from importing and accessing things. Instead Python follows the principle of â€œweâ€™re all adults hereâ€, and uses some conventions to indicate things like private and internal functions. See <a href="https://peps.python.org/pep-0008/#descriptive-naming-styles">the section of PEP8 on naming</a>, in particular, where it talks about <tt>_single_leading_underscore</tt> as a weak â€œinternal useâ€ indicator.</p>
</div>
<p>The other advantage of breaking code up into many modules within a subpackage, from your perspective as a maintainer, is that you can easily focus on one little chunk of code at a time. I <em>promise</em> that in the long run, this will help you, especially when you need to context switch and work on multiple things at once. <em>Especially</em> if thereâ€™s some helper functions and youâ€™re not having to scroll or jump around through 3000 lines of code to find them.</p>
</section>
<section id="finally-dont-name-a-module-package.utils-or-package.utilities" class="level2">
<h2 class="anchored" data-anchor-id="finally-dont-name-a-module-package.utils-or-package.utilities">Finally, donâ€™t name a module <code>package.utils</code> or <code>package.utilities</code></h2>
<p>Someone even more jaded than me has already said this: <a href="https://breadcrumbscollector.tech/stop-naming-your-python-modules-utils/" class="uri">https://breadcrumbscollector.tech/stop-naming-your-python-modules-utils/</a></p>
<p>The basic idea is that the concept of <code>utilities</code> is so nebulous that more and more things will end up crammed into this module, that are less and less related to each other. This is especially likely if multiple people are developing a package, and they are tempted by the name <code>utilities</code> to add <em>just</em> one more helper or validation function inside that (now gigantic) module when trying to add a new feature.</p>
<p>Hold on, friend. Take a step back, take a deep breath. Itâ€™s okay to add a module with just a single function. You can just have a module named <code>timestamp</code> with only one function <code>get_timestamp</code>, and have it be only 10 lines. Please believe me, it will make the codebase easier to read, it will make internal usage of the function easier to read, it will make it easier to write quick unit tests. You do <strong>not</strong> want to hold 500 lines of <code>utils</code> in your head when youâ€™re trying to track down a bug. If you donâ€™t like that your top-level namespace gets cluttered by these little modules, than pull out our sub-package trick from above to push those modules down a level.</p>
<p>So thatâ€™s me saying what that other blog post said, after I said they already said it. All I want to add here is that the same logic from above applies: you <em>want</em> people to use your package. So <em>give</em> the modules <em>very specific</em> names so people know exactly what everything is doing. It will help your potential users and it will help future you.</p>
</section>
<section id="take-homes" class="level2">
<h2 class="anchored" data-anchor-id="take-homes">Take-homes</h2>
<p>At the risk of repeating myself, let me tell you again why youâ€™d want to take these tips to heart. You want people to use your library that youâ€™re sharing with the world. Itâ€™s amazing; people can go onto the internet and just <em>use</em> the tools you put all that effort into! As a researcher, this is the kind of instant gratification you canâ€™t get when you are taking on the Herculean task of putting reality into a headlock with an experiment.</p>
<p>So make the most of it! Give your Python packages and modules names with just a few letters, and make use of imports and sub-packages to further structure the namespace of your package so that itâ€™s convenient to work with. This will also benefit you in the long run when youâ€™re working with your own code.</p>
<p>Since Iâ€™m writing for research scientists, I will of course end the discussion by claiming that this blog sets the stage for future research. A good question would be, has anybody done any research supporting my claims that these tips will help you and others read and use your code? If I ever finish reading <a href="https://www.manning.com/books/the-programmers-brain">The Programmerâ€™s Brain</a>, Iâ€™ll probably be able to tell you. Stay tuned for another post. ğŸ™‚</p>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>See similar comments from core Python dev Brett Cannon in this post, <a href="https://snarky.ca/if-i-were-designing-imort-from-scratch/" class="uri">https://snarky.ca/if-i-were-designing-imort-from-scratch/</a> in the section â€œYou can only import modulesâ€.<a href="#fnref1" class="footnote-back" role="doc-backlink">â†©ï¸</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/blog\.nicholdav\.info");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>